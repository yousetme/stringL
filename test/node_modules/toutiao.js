!function () {
    function initGlobalObj() {
        Query = GUELib.Query, Query.initQuery()
    }

    function isPcPlatform(t, e, n) {
        var i = !1, r = t, a = !!document.createElement("video").canPlayType;
        return n.type ? "video" == n.type ? i = !1 : "flash" == n.type && (i = !0) : r.flashPlat.win ? i = navigator.userAgent.indexOf("WebView") > -1 || navigator.userAgent.indexOf("WPDesktop") > -1 ? !1 : !0 : r.flashPlat.mac ? i = !0 : e.Support.linux ? r.swfPlayEnable(10) ? i = !0 : a && (i = !1) : i = !1, "LETV" == Query.get("dbd") && (i = !1), window.letvcloud_player_conf && "LETV" == letvcloud_player_conf.dbd && (i = !1), i
    }

    function getHtmlConf() {
        document.title = Query.get("title") || "涔愯浜�";
        var t = {w: Query.get("width") || 750, h: Query.get("height") || 422, vu: Query.get("vu"), uu: Query.get("uu"), pu: Query.get("pu"), parentId: "player", autoplay: Query.get("auto_play"), version: 10, swf: null, flashvars: Query.getall("string")};
        return Query.get("payer_name") && (t.payer_name = Query.get("payer_name")), Query.get("check_code") && (t.check_code = Query.get("check_code")), "100%" == t.w && (t.w = 0), "100%" == t.h && (t.h = 0), t
    }

    function getJsConf() {
        var scripts = window.document.getElementsByTagName("script"), dScript = scripts[scripts.length - 1], depend = dScript.getAttribute("depend"), data = dScript.getAttribute("data"), option = null;
        return data && (data = eval("(" + data + ")"), option = {w: Util.checkParam(data.width), h: Util.checkParam(data.height), vu: data.vu, uu: data.uu, autoplay: data.auto_play, version: 10, swf: null, flashvars: Util.paramstr(data), parentId: "playerbox" + ("" + Math.random()).split(".")[1]}, void 0 != data.payer_name && (option.payer_name = data.payer_name), void 0 != data.check_code && (option.check_code = data.check_code), void 0 != data.callback && (option.callback = data.callback), void 0 != data.type && (option.type = data.type)), option
    }

    function getConf() {
        option = void 0 == window.domainname ? getHtmlConf() : getJsConf(), option.cf = GUELib.Support.ipad || GUELib.Support.ipod || GUELib.Support.iphone ? "html5_ios" : "html5", option.url = "http://api.letvcloud.com/gpc.php?cf=" + option.cf + "&sign=signxxxxx&ver=2.1&format=jsonp&pver=html5_1.1.1&bver=" + encodeURIComponent(getBrowserVersion()) + "&uuid=" + Util.getUUID();
        var t = "http://yuntv.letv.com/bcloud.swf";
        return"undefined" != typeof _user_defined && _user_defined[option.uu] && (t = _user_defined[option.uu][option.pu || "default"]), option.swf = t, option
    }

    function play() {
        var t = getConf();
        if (t && !t.vu)return alert("瑙嗛涓嶅瓨鍦�");
        var e = t.w ? t.w + "px" : "100%", n = t.h ? t.h + "px" : "100%";
        document.write('<div id="' + t.parentId + '" style="width:' + e + ";height:" + n + ';margin-right:auto;margin-left:auto;"></div>'), void 0 == window.ReviveSWF && (ReviveSWF = null);
        var i = isPcPlatform(ReviveSWF, GUELib, t);
        i ? ReviveSWF.echo(t.parentId, t) : initHTML5Player(GUELib, t)
    }

    function initHTML5Player(t, e) {
        var n = new Reportor;
        n.init(), n.sendEnvInfo({}), n.startTiming();
        var i = {vu: e.vu, uu: e.uu};
        "undefined" != typeof e.payer_name && "undefined" != typeof e.check_code && (i = {vu: e.vu, uu: e.uu, payer_name: e.payer_name, check_code: e.check_code}), t.GetJSON(e.url, i, function (i) {
            n.stopTiming();
            var r = n.timer.getTimeM();
            return i.code ? (n.sendPlayAction({ac: "init", pt: 0, err: 1, ut: r}), e.callback && window[e.callback](null), t.Video.setup(e.parentId, [], e.w, e.h), alert("涓嶅悎娉曡姹�!")) : (n.initVideoInfo(i, e), n.sendPlayAction({ac: "init", pt: 0, err: 0, ut: r}), void setupPlayer(n, e, i))
        })
    }

    function setupPlayer(t, e, n) {
        var i = n.data.video_info, r = i.default_play, a = GUELib.Video.setup(e.parentId, [], e.w, e.h, {event: {playing: function () {
            t.turnOnPlayingStatus(), t.startTiming(), t.firstPlay && (t.turnOffFirstPlaystatus(), t.sendPlayAction({ac: "play", pt: 0, err: 0, ut: 1})), t.isEndedBefore && (t.emptyChunkQueue(), t.stopTimer(), t.startTimer(), t.turnOffEndStatus())
        }, waiting: function () {
            t.setTimeChunkPaused()
        }, seeking: function () {
            t.setTimeChunkPaused()
        }, pause: function () {
            t.setTimeChunkPaused()
        }, ended: function () {
            t.sendEndAction()
        }, abort: function () {
            t.sendEndAction()
        }}});
        t.video = a.video;
        var o = i.media[r].play_url.main_url;
        if (a.source(BaseCode.decode(o)), e.callback)t.sendPlay(), window[e.callback](a.video); else {
            a.getSource(i);
            var u = n.data.play_info.init_pic;
            "" != u || null != u ? a.poster(u) : "0" != e.autoplay ? (a.video.autoplay = "autoplay", a.play()) : a.video.autoplay = ""
        }
    }

    function Reportor() {
        var t = Util.getUUID(), e = Util.getLC(), n = {envUrl: "http://dc.letv.com/env/?", playUrl: "http://dc.letv.com/pl/?"};
        return{timer: null, timeChunkQueue: [], playStartTime: 0, actStartTime: 0, firstPlay: !0, videoInfo: {vid: "", vlen: 0, ch: "", ap: 1}, video: null, isPlayingBefore: !1, isEndedBefore: !0, turnOnPlayingStatus: function () {
            this.isPlayingBefore = !0
        }, turnOffPlayingStatus: function () {
            this.isPlayingBefore = !1
        }, turnOffFirstPlaystatus: function () {
            this.firstPlay = !1
        }, turnOnEndStatus: function () {
            this.isEndedBefore = !0
        }, turnOffEndStatus: function () {
            this.isEndedBefore = !1
        }, emptyChunkQueue: function () {
            this.timeChunkQueue = []
        }, init: function () {
            var t = this;
            this.timer = new Util.Timer(18e4, function () {
                t.sendTimeAction()
            })
        }, startTimer: function () {
            var t = this, e = setTimeout(function () {
                t.sendTimeAction();
                var e = t.getVideoLenM();
                t.timer.setDelay(3 > e ? 3e4 : 10 > e ? 6e4 : 18e4), t.timer.start()
            }, 15e3);
            this.timer.setCurrTimerId(e)
        }, stopTimer: function () {
            null != this.timer && this.timer.stop()
        }, startTiming: function () {
            this.timer.startTiming()
        }, stopTiming: function () {
            this.timer.stopTiming()
        }, setTimeChunkPaused: function () {
            this.setTimeChunk(), this.turnOffPlayingStatus()
        }, setTimeChunk: function () {
            if (this.video && !this.video.paused && (this.isPlayingBefore = !0), this.isPlayingBefore) {
                var t = this.timer.stopTiming().getTimeM();
                this.timeChunkQueue.push(t)
            }
            this.startTiming()
        }, initVideoInfo: function (t, e) {
            var n = e.ac;
            n = 0 == n ? 0 : 1;
            var i = t.data.video_info, r = i.video_id, a = i.video_duration, o = "bcloud_" + i.user_id, u = 1;
            this.videoInfo = {vid: r, vlen: a, ch: o, ap: u}
        }, getVideoLenM: function () {
            return Math.round(this.videoInfo.vlen / 60)
        }, getPlayTimeAHeartBeat: function () {
            this.setTimeChunk();
            for (var t = this.timeChunkQueue, e = t.length, n = 0, i = 0; e > i; i++)n += t[i];
            return this.emptyChunkQueue(), Math.round(n / 1e3)
        }, sendPlay: function () {
            this.sendPlayAction({ac: "play", pt: 0, err: 0, ut: 1})
        }, sendPlayAction: function (i) {
            var r = this.videoInfo, a = Util.extend({ver: "2.0", p1: 3, p2: 31, p3: "-", uid: "-", auid: "-", cid: 100, pid: "-", pv: "1.1", py: "-", url: Util.getBroswerUrl(), vid: r.vid, vlen: r.vlen, ch: r.ch, ap: r.ap, uuid: t, lc: e}, i);
            return Util.send(n.playUrl + Util.addParams(a)), this
        }, sendEnvInfo: function (i) {
            var r = Util.extend({p1: 3, p2: 31, p3: "-", ip: "-", mac: "-", nt: "-", app: "1.1", lc: e, uuid: t}, i);
            Util.send(n.envUrl + Util.addParams(r))
        }, sendEndAction: function () {
            this.stopTimer(), this.sendTimeAction(), this.sendPlayAction({ac: "end", pt: 0, err: 0, ut: 0}), this.turnOnEndStatus()
        }, sendTimeAction: function () {
            this.sendPlayAction({ac: "time", pt: this.getPlayTimeAHeartBeat(), err: 0, ut: 0})
        }}
    }

    function getBrowserVersion() {
        var t, e = {}, n = navigator.userAgent.toLowerCase();
        (t = n.match(/msie ([\d.]+)/)) ? e.msie = t[1] : (t = n.match(/firefox\/([\d.]+)/)) ? e.firefox = t[1] : (t = n.match(/360browser/)) ? e.b360 = t[1] ? t[1] : "-" : (t = n.match(/qqbrowser\/([\d.]+)/)) ? e.bqq = t[1] : (t = n.match(/ucbrowser\/([\d.]+)/)) ? e.buc = t[1] : (t = n.match(/baidubrowser\/([\d.]+)/)) ? e.bbaidu = t[1] : (t = n.match(/sogoumobilebrowser\/([\d.]+)/)) ? e.bsgm = t[1] : (t = n.match(/liebaofast\/([\d.]+)/)) ? e.blbfast = t[1] : (t = n.match(/mb2345browser\/([\d.]+)/)) ? e.b2345 = t[1] : (t = n.match(/4g explorer\/([\d.]+)/)) ? e.b4g = t[1] : (t = n.match(/huohoubrowser\/([\d.]+)/)) ? e.bhuohou = t[1] : (t = n.match(/maxthon[\/ ]([\d.]+)/)) ? e.maxthon = t[1] : (t = n.match(/(opera)|(opr)\/([\d.]+)/)) ? e.opera = t[3] : (t = n.match(/chrome\/([\d.]+)/)) ? e.chrome = t[1] : (t = n.match(/version\/([\d.]+).*safari/)) ? e.safari = t[1] : e.other = "-";
        var i = "";
        for (var r in e)i = r + e[r];
        return i
    }

    function gotoShareUrl() {
        var t = Util.trim(Query.get("skip")), e = Util.trim(Query.get("page_url"));
        "fenxiang" == t && "" != e && (window.location.href = unescape(e))
    }

    var Util = {Timer: function (t, e) {
        function n() {
            return(new Date).getTime()
        }

        var i, r, a, o = !1;
        return{delay: function () {
            return t
        }, isRunning: function () {
            return o
        }, start: function () {
            var n = this;
            return o = !0, i && clearTimeout(i), i = setTimeout(function () {
                e && e(), n.start()
            }, t), this
        }, stop: function () {
            return clearTimeout(i), o = !1, this
        }, setDelay: function (e) {
            t = e
        }, reset: function () {
            return i || this.start(), this
        }, startTiming: function () {
            return r = n(), this
        }, stopTiming: function () {
            return a = n(), this
        }, getTimeM: function () {
            return a - r
        }, getTimeS: function () {
            return Math.round((a - r) / 1e3)
        }, setCurrTimerId: function (t) {
            i = t
        }}
    }, extend: function () {
        var t, e, n = arguments[0], i = !0, r = 1, a = arguments.length;
        if ("boolean" == typeof n && (i = n, n = arguments[1] || {}, r = 2), a == r)return n || {};
        for (; a > r; r++) {
            t = arguments[r];
            for (e in t)i && void 0 !== n[e] || (n[e] = t[e])
        }
        return n
    }, send: function (t) {
        var e = new Image(1, 1);
        e.onload = e.onerror = e.onabort = function () {
            e.onload = e.onerror = e.onabort = null, e = null
        }, e.src = t
    }, addParams: function (t) {
        var e = [];
        for (var n in t)e.push(n + "=" + t[n]);
        return e.join("&")
    }, getCookie: function (t) {
        var e = document.cookie.match(new RegExp("(^| )" + t + "=([^;]*)(;|$)"));
        return null != e ? unescape(e[2]) : ""
    }, addCookie: function (t, e, n) {
        n = n || {}, null === e && (e = "", n.expires = -1);
        var i = "";
        if (n.expires && ("number" == typeof n.expires || n.expires.toUTCString)) {
            var r;
            "number" == typeof n.expires ? (r = new Date, r.setTime(r.getTime() + 24 * n.expires * 60 * 60 * 1e3)) : r = n.expires, i = "; expires=" + r.toUTCString()
        }
        var a = n.path ? "; path=" + n.path : "", o = n.domain ? "; domain=" + n.domain : "", u = n.secure ? "; secure" : "";
        document.cookie = [t, "=", encodeURIComponent(e), i, a, o, u].join("")
    }, getBroswerUrl: function () {
        return encodeURIComponent(window.location.href)
    }, getUUID: function () {
        if (void 0 != this.uuid)return this.uuid;
        var t = "1" + String((new Date).getTime()).slice(4) + String(Math.random()).slice(-6);
        return this.uuid = t
    }, getLC: function () {
        var t = Util.getCookie("tj_lc");
        if ("" == t) {
            for (var t = "", e = 32; e--;)t += Math.floor(16 * Math.random()).toString(16);
            var n = new Date;
            n.setFullYear(n.getFullYear() + 20), Util.addCookie("tj_lc", t, {expires: n, domain: ".letv.com", path: "/"})
        }
        return t
    }, paramstr: function (t) {
        var e = [];
        for (var n in t) {
            var i = n + "=" + t[n];
            e.push(i)
        }
        var r = e.join("&");
        return r
    }, checkParam: function (t) {
        if (void 0 == t)return"";
        var e = t, n = t.length, i = t.substr(n - 1, 1), r = t.substr(n - 2, 2);
        return"%" == i ? e = 0 : "px" == r && (e = t.substr(0, n - 2)), e
    }, trim: function (t) {
        if (String.prototype.trim && !String.prototype.trim.call("锘柯 "))return null == t ? "" : String.prototype.trim.call(t);
        var e = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
        return null == t ? "" : (t + "").replace(e, "")
    }};
    initGlobalObj(), gotoShareUrl(), play()
}();